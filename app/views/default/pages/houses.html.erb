<%
  # Fetch all houses from the resource
  houses_resource = Spina::Resource.find_by(name: "houses")
  houses = houses_resource&.pages&.live&.sorted || []
%>

<article class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-12 md:py-16">
  <!-- Header -->
  <header class="mb-12 text-center">
    <h1 class="text-4xl md:text-5xl font-light text-stone-800 tracking-tight">
      <%= current_page.title %>
    </h1>
  </header>

  <!-- Introduction text -->
  <% if content.html(:text).present? %>
    <div class="prose prose-stone prose-lg max-w-3xl mx-auto mb-12">
      <%= content.html(:text) %>
    </div>
  <% end %>

  <!-- Houses grid -->
  <% if houses.any? %>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
      <% houses.each do |house| %>
        <a href="<%= house.materialized_path %>" class="group block">
          <div class="bg-white rounded-lg overflow-hidden shadow-sm hover:shadow-md transition-shadow">
            <!-- Thumbnail image -->
            <div class="aspect-[4/3] bg-stone-200 overflow-hidden">
              <% first_image = house.find_part(:house_images)&.content&.first %>
              <% if first_image %>
                <%= house.content.image_tag first_image, { resize_to_fill: [600, 450] },
                    { class: "w-full h-full object-cover transition-transform duration-300 group-hover:scale-105" } %>
              <% end %>
            </div>

            <!-- Content -->
            <div class="p-6">
              <% if house.content(:house_name).present? %>
                <p class="text-sm text-emerald-700 font-medium mb-1"><%= house.content(:house_name) %></p>
              <% end %>
              <h2 class="text-xl font-medium text-stone-800 mb-3 group-hover:text-emerald-700 transition-colors">
                <%= house.title %>
              </h2>

              <!-- Quick details -->
              <div class="flex flex-wrap gap-4 text-sm text-stone-500">
                <% if house.content(:house_bedrooms).present? %>
                  <span><%= house.content(:house_bedrooms) %> soveværelser</span>
                <% end %>
                <% if house.content(:house_sqm).present? %>
                  <span><%= house.content(:house_sqm) %> m²</span>
                <% end %>
              </div>

              <!-- Price -->
              <% if house.content(:house_pricing).present? %>
                <p class="mt-4 text-lg font-medium text-emerald-700"><%= house.content(:house_pricing) %></p>
              <% end %>
            </div>
          </div>
        </a>
      <% end %>
    </div>
  <% else %>
    <p class="text-center text-stone-500">Ingen boliger tilgængelige i øjeblikket.</p>
  <% end %>

  <!-- Back link -->
  <nav class="mt-12 pt-8 border-t border-stone-200">
    <a href="<%= spina.root_path %>" class="group inline-flex items-center text-stone-800 hover:text-emerald-700 transition-colors">
      <svg class="mr-2 w-4 h-4 transform translate-x-0 group-hover:-translate-x-1 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
      </svg>
      <span class="text-lg">Tilbage til forsiden</span>
    </a>
  </nav>
</article>
