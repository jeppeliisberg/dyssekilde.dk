<%
  # Collect image data for the lightbox
  gallery_data = []
  images(:gallery_images) do |image|
    gallery_data << {
      url: content.image_url(image, resize_to_limit: [2048, 2048]),
      alt: image.alt.presence || current_page.title
    }
  end
%>

<article class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12 md:py-16"
         data-controller="lightbox"
         data-lightbox-images-value="<%= gallery_data.to_json %>">
  <!-- Header -->
  <header class="mb-12 text-center">
    <h1 class="text-4xl md:text-5xl font-light text-stone-800 tracking-tight">
      <%= current_page.title %>
    </h1>
  </header>

  <!-- Introduction text -->
  <% if content.html(:text).present? %>
    <div class="prose prose-stone prose-lg max-w-3xl mx-auto mb-12">
      <%= content.html(:text) %>
    </div>
  <% end %>

  <!-- Gallery grid -->
  <% if gallery_data.any? %>
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
      <% index = 0 %>
      <% images(:gallery_images) do |image| %>
        <button type="button"
                class="group relative aspect-square overflow-hidden rounded-lg bg-stone-200 cursor-pointer"
                data-action="lightbox#open"
                data-index="<%= index %>">
          <%= content.image_tag image, { resize_to_fill: [600, 600] },
              { class: "absolute inset-0 w-full h-full object-cover transition-transform duration-300 group-hover:scale-105",
                loading: "lazy" } %>
          <div class="absolute inset-0 bg-stone-900/0 group-hover:bg-stone-900/20 transition-colors duration-300"></div>
        </button>
        <% index += 1 %>
      <% end %>
    </div>
  <% else %>
    <p class="text-center text-stone-500">No images in this gallery yet.</p>
  <% end %>

  <!-- Lightbox overlay -->
  <div data-lightbox-target="overlay"
       data-action="click->lightbox#backdropClick"
       class="hidden fixed inset-0 z-50 bg-black/90 flex justify-center items-center">
    <!-- Close button -->
    <button type="button"
            data-action="lightbox#close"
            class="absolute top-4 right-4 text-white text-2xl h-10 w-10 flex items-center justify-center bg-gray-900/50 rounded-full hover:bg-gray-900/70 transition-colors">
      <span class="sr-only">Luk</span>
      &times;
    </button>

    <!-- Previous button -->
    <button type="button"
            data-action="lightbox#previous"
            class="absolute left-4 text-white text-2xl h-10 w-10 flex items-center justify-center bg-gray-900/50 rounded-full hover:bg-gray-900/70 transition-colors">
      <span class="sr-only">Forrige</span>
      &larr;
    </button>

    <!-- Image -->
    <img data-lightbox-target="image"
         src=""
         alt=""
         class="max-w-full max-h-full object-contain p-4">

    <!-- Next button -->
    <button type="button"
            data-action="lightbox#next"
            class="absolute right-4 text-white text-2xl h-10 w-10 flex items-center justify-center bg-gray-900/50 rounded-full hover:bg-gray-900/70 transition-colors">
      <span class="sr-only">Naeste</span>
      &rarr;
    </button>
  </div>

  <!-- Back link -->
  <nav class="mt-12 pt-8 border-t border-stone-200">
    <a href="<%= spina.root_path %>" class="group inline-flex items-center text-stone-800 hover:text-emerald-700 transition-colors">
      <svg class="mr-2 w-4 h-4 transform translate-x-0 group-hover:-translate-x-1 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
      </svg>
      <span class="text-lg">Tilbage til forsiden</span>
    </a>
  </nav>
</article>
